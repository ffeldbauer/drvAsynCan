#####################################################
# ###                                           ### #
# ### EPICS Database for                        ### #
# ### DigitizerBoard for Capacitec              ### #
# ###                                           ### #
# ### author: F.Feldbauer                       ### #
# ###                                           ### #
# ### Ref 1.0; 2013-08-27                       ### #
# ###                                           ### #
# ### macros: subsys  PANDA subsystem           ### #
# ###         ID      Board ID                  ### #
# ###         sector  Sector of subsys          ### #
# ###         BUS     Asyn Port                 ### #
# ###         no      channel number            ### #
# ###         P0      calibration param 0       ### #
# ###         P1      calibration param 1       ### # 
#####################################################

####################
# ### Triggers ### #
####################
record (bo, "PANDA:$(subsys):POSITION:$(ID):TriggerAdcBuffer") {
  field (DTYP, "asynInt32")
  field (OUT,  "@asyn($(BUS),0,1)Readout")
}

record (mbbi, "PANDA:$(subsys):POSITION:$(ID):Error") {
  field (DTYP, "asynUInt32Digital")
  field (SCAN, "I/O Intr")
  field (INP,  "@asynMask($(BUS),0,0xffff,1)Error")
}

################
# ### Data ### #
################
record (ai, "PANDA:$(subsys):POSITION:$(sector):D") {
  field (DTYP, "asynInt32")
  field (SCAN, "I/O Intr")
  field (INP,  "@asyn($(BUS),$(no),1)Value")

  # display parameters
  field (EGU,  "um")
  field (PREC, "2")

  # Conversion parameters
  field (ASLO, "$(P1)")
  field (AOFF, "$(P0)")

  # Alarm Limits
  field (HIHI, "1001")
  field (HIGH, "1000")
  field (LOW,  "-1000")
  field (LOLO, "-1001")

  # Alarm Severities
  field (HHSV, "NO_ALARM")
  field (HSV,  "NO_ALARM")
  field (LSV,  "MINOR")
  field (LLSV, "MAJOR")

  # Archive and Monitor deadbands
  field (ADEL, "0.05")
  field (MDEL, "0.05")
}

record( mbbo, "PANDA:$(subsys):POSITION:$(ID):SetOverSampling" ) {
  field( DTYP, "asynInt32" )
  field( OUT,  "@asyn($(BUS),0,1)OS" )

  # state strings
  field( ZRST, "No OS" )
  field( ONST, "2" )
  field( TWST, "4" )
  field( THST, "8" )
  field( FRST, "16" )
  field( FVST, "32" )
  field( SXST, "64" )

  # state values
  field( ZRVL, "0" )
  field( ONVL, "1" )
  field( TWVL, "2" )
  field( THVL, "3" )
  field( FRVL, "4" )
  field( FVVL, "5" )
  field( SXVL, "6" )
}

record( mbbi, "PANDA:$(subsys):POSITION:$(ID):GetOverSampling" ) {
  field( DTYP, "asynInt32" )
  field( INP,  "@asyn($(BUS),0,1)OS" )

  # state strings
  field( ZRST, "No OS" )
  field( ONST, "2" )
  field( TWST, "4" )
  field( THST, "8" )
  field( FRST, "16" )
  field( FVST, "32" )
  field( SXST, "64" )

  # state values
  field( ZRVL, "0" )
  field( ONVL, "1" )
  field( TWVL, "2" )
  field( THVL, "3" )
  field( FRVL, "4" )
  field( FVVL, "5" )
  field( SXVL, "6" )
}
